# Alerts

#### FW Version: 7135+

Alerts can be generated by system automatically either

* EMail alerts
* Syslog alerts

Configuration file is located in 

```text
/opt/fmadio/etc/alert.lua
```

### SYSLOG Alerts

An example configuration file with alert via syslog

```text
local L =
{
["AlertList"] =
{
    BytesOverflow   = true,
    PacketError     = true,
    PacketDrop      = true,
    DiskFreeStore0  = 4e9,
    DiskFreeStore1    = 1000e9,
    DiskFreeRemote0   = 10e9,
    Sleep           = 60,                           -- how long to sleep when an alert is triggered. prevents flodding
}
}
return L

```

The above example will generate syslog alerts as follows. Syslog alerts are always enabled

```text
2021.05.24-17:44:20.001457 (+09:00) | fmadio20v3-287 | local7.alert    | fmadio    | Alert     /mnt/store0 disk space low. Free 60.127GB (60127121408B) [Threshold 100.000GB]
2021.05.24-17:44:20.002903 (+09:00) | fmadio20v3-287 | local7.alert    | fmadio    | Alert     /mnt/store1 disk space low. Free 895.712GB (895712038912B) [Threshold 1000.000GB]
2021.05.24-17:44:25.444418 (+09:00) | fmadio20v3-287 | local7.alert    | fmadio    | Alert     /mnt/store0 disk space low. Free 60.127GB (60126965760B) [Threshold 100.000GB]
2021.05.24-17:44:25.446463 (+09:00) | fmadio20v3-287 | local7.alert    | fmadio    | Alert     /mnt/store1 disk space low. Free 895.712GB (895712038912B) [Threshold 1000.000GB]

```

### EMAIL Alerts

Email alerts can be setup as the following, please add the "Email" section in the configuration file

```text
local L =
{
["Email"] =
{
    Enable  = true,
    To      = "alerts@fmad.io",
    From    = "packet_capture@fmad.io",
}
,
["AlertList"] =
{
    BytesOverflow   = true,
    PacketError     = true,
    PacketDrop      = true,
    DiskFreeStore0  = 4e9,
    Sleep           = 60, 
}
}
return L

```

In addition fmadio packet capture system uses msrtp as the email client, it requires smtp configuration file 

```text
/opt/fmadio/etc/msmtp.rc
```

Example configuration as follows. Please edit to match the email smtp provier

```text
defaults
tls on
tls_certcheck off
logfile /mnt/store0/log/msmtp.log
tls_starttls on

account default
host mail.yourserver.com
port 587
auth on
user fmadio@yourserver.com
password <sercrets>

```

### Syntax

#### BytesOverflow

Any time Bytes Over increases an alert is generated. This typically a symptom of capture rates being too high, or HDD writeback too slow \(or failing\)

**PacketError**

Counts FCS errors received on the interface. Any time packet error counts changes an alert is generated. Typically occurs when there are Layer1 link stability issues

**PacketDrop**

Alerts generated when packets are dropped on the capture device. 

**DiskFreeStore0**

When space on /mnt/store0 partition is less than this amount \(scientific notition\) in bytes. Alerts are generated. In the above example

```text
    DiskFreeStore0  = 4e9,
```

In the above example, an alert is generated when less than 4e9 \(4GB\) of space is free on /mnt/store0 partition

**DiskFreeStore1**

When space on /mnt/store1 \(scratch analytics workspace\) is less than this amount \(scientific notation\) in bytes an Alert is generated

**DiskFreeRemote0**

When space on the /mnt/remote0 \(typically NFS mount partition\) is less than this threashold an Alert is generated

**Sleep**

Minimum number of seconds between alert generation. This is to prevent spamming of alerts due to unexpected system conditions.





